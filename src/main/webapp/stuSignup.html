
<!doctype html>
<html  lang="en">

    <head>
        <!-- meta data -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

        <!--font-family-->
		<link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900&amp;subset=devanagari,latin-ext" rel="stylesheet">
        
        <!-- title of site -->
        <title>学生在线考试系统注册</title>

        <!-- For favicon png -->
		<link rel="shortcut icon" type="image/icon" href="assets/logo/favicon.png"/>
       
        <!--font-awesome.min.css-->
        <link rel="stylesheet" href="assets/css/font-awesome.min.css">
		
		<!--animate.css-->
        <link rel="stylesheet" href="assets/css/animate.css">
		
        <!--bootstrap.min.css-->
        <link rel="stylesheet" href="assets/css/bootstrap.min.css">
		
		<!-- bootsnav -->
		<link rel="stylesheet" href="assets/css/bootsnav.css" >	
        
        <!--style.css-->
        <link rel="stylesheet" href="assets/css/style.css">
        
        <!--responsive.css-->
        <link rel="stylesheet" href="assets/css/responsive.css">
        
		<!--layuiJS -->
		<script src="./lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="./js/xadmin.js"></script>
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		
        <!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
		<script type="text/javascript" src="./js/jquery-3.3.1.js"></script>
		<script type="text/javascript">
		    //全局定义一次, 加载formSelects
		    layui.config({
		        base: './js/' //此处路径请自行处理, 可以使用绝对路径
		    }).extend({
		        formSelects: 'formSelects-v4'
		    });
		    //加载模块
		    layui.use(['jquery', 'formSelects'], function(){
		        var formSelects = layui.formSelects;
		         
		    });
		</script>
		
    </head>
	
	<body>
		<!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
		
		<!-- signin end -->
		<section class="signin signup" style="height:815px">
			<div class="container">
				<div class="sign-content">
					<h2>学 生 注 册</h2>
						<form class="layui-form layui-form-pane" >
							<div class="signin-form">
								<div class=" ">
									<div class=" ">	
										<div class="layui-form-item">
											<label for="stuid1" >学号</label>
											<input type="text" class="form-control" name="userId" id="stuid1" placeholder="Student ID" lay-verify="required|number" autocomplete="off">
										</div><!--/.form-group -->
										<div class="layui-form-item">
											<label for="stuid2">确认学号</label>
											<input type="text" class="form-control" id="stuid2" placeholder="Enter your student ID again" lay-verify="required|recheck" autocomplete="off">
									
										
										
										<div class="layui-form-item" >
											<label for="classId" style="height:30px;">班级</label>
										</div><!--/.form-group -->
										<link rel="stylesheet" href="./css/formSelects-v4.css" />
										<div>
								            <select id="classId" name="classId" class="valid" lay-filter="classId" xm-select="select1" xm-select-search="" xm-select-radio="" xm-select-search-type="dl" >
								            	<option value="">请选择你所在班级</option>
								            </select>
								        </div>	
										
										
										<div class="layui-form-item">
											<label for="realname">姓名</label>
											<input type="text" class="form-control" name="realname" id="realname" placeholder="First name" lay-verify="required|checkname|checkChina" autocomplete="off">
										</div><!--/.form-group -->
										
										<div class="layui-form-item">
											<label for="newpwd1">密码</label>
											<input type="password" class="form-control" name="password" id="newpwd1" placeholder="Enter your password" lay-verify="required|pwdlength" autocomplete="off">
										</div><!--/.form-group -->
										
										<div class="layui-form-item">
											<label for="newpwd2">确认密码</label>
											<input type="password" class="form-control"  id="newpwd2" placeholder="Enter your password again" lay-verify="required|repass" autocomplete="off">
										</div><!--/.form-group -->
										
										<div class="layui-form-item">
											<label for="email">绑定邮箱</label>
											<input type="email" class="form-control" name="email" id="email" placeholder="Enter your email adress " lay-verify="email|required" autocomplete="off">
										</div><!--/.form-group -->										
									</div><!--/.col -->
								</div><!--/.row -->
							</div><!--/.signin-form -->
							<div class="signin-password" >
								<div class="password-circle">
									<div class="single-password-circle" style="width:300px;position:relative;" >
										<div style="float:left;margin-top:4px;color:#555555">
											<span class="round-boarder">验证码：</span>
										</div>
										<div style="float:left;">
											<input class="form-control" type="text" name="rancode" id="inputNum" value=""  placeholder="" onfocus="showValidate()"
											style="height: 30px;width: 70px; background-color:#F7F7F7; text-align: center;" lay-verify="validate" autocomplete="off">
										</div>
										<div id="validate" style="float:left;margin-top: 3px; margin-left:250px; display:none" >
											<img  style="cursor: pointer;height: 34px; width:80px; position: absolute;margin-left:-110px;margin-top: -34px;border: 1px solid;border-radius: 2px" src="" id="img" onclick="changeRanCode()" >
											<span id="numSpan2" style="font-size:10px;font-weight:normal;" ></span>
										</div>		
									</div><!--/.single-password-circle-->
									<div class="single-forgot-password-circle text-right ">
										<a href="requertResetPassword.html">找回账号</a>
									</div><!--/.single-password-circle-->
								</div><!--/.password-circle-->
							</div><!--/.signin-password -->
					
							<div class="layui-form-item" style="text-align: center">							
								<button  class="layui-btn btn signin_btn signin_btn_two" lay-submit="" lay-filter="signup" style="background-color: #1C86EE" >
								立即注册
								</button>
								<p>
									</br>
									<a href="login.html" style="font-size:13px">返回登录页面</a>
								</p>
							</div><!--/.signin-footer -->
						</form>
				</div><!--/.sign-content -->

				
			</div><!--/.container -->

		</section><!--/.signin -->
		
		<!-- signin end -->

		<!--footer copyright start -->
		<footer class="footer-copyright">
			<div id="scroll-Top">
				<i class="fa fa-angle-double-up return-to-top" id="scroll-top" data-toggle="tooltip" data-placement="top" title="" data-original-title="Back to Top" aria-hidden="true"></i>
			</div><!--/.scroll-Top-->

		</footer><!--/.hm-footer-copyright-->
		<!--footer copyright  end -->


		<script>
			/* 获取下拉班级信息 */
			getSelectClass();
			
			
			 layui.use(['form', 'layer'],
	            function() {
	                $ = layui.jquery;
	                var form = layui.form,
	                layer = layui.layer;
	
	               //自定义验证规则
					form.verify({
						checkname: function(value) {
							if (value.length < 2) {
								return '用户名至少要2个字符';
							}
						}, 
						pwdlength: function(value) {
							if (value.length < 6 && value!="") {
								return '用户密码至少要6个字符';
							}
						}, 
						repass: function(value) {
							if ($('#newpwd1').val() != $('#newpwd2').val()) {
								return '两次输入的密码不一致';
							}
						},
						validate: function(value) {
							if (value=="") {
								return '请输入验证码';
							}
						},
						recheck: function(value) {
							if (value!=$('#stuid1').val()) {
								return '两次输入的学号不一致';
							}
						}
					});
					form.verify({
						checkChina: [
						    /[\u4E00-\u9FA5]/
						    ,'请填写真实中文姓名'
						 ]
					});
	                //监听提交
	                form.on('submit(signup)',
	                function(data) {
	                	var layerIndex = layer.load(1, { shade: [0.5, '#393D49'] });	//加载动画
	                    $.ajax({
							type: "POST",
							url: "User/Register?userId=" + $("#stuid1").val() + "&password=" + $("#newpwd1").val()
								+ "&realname=" + $("#realname").val() + "&rancode=" + $("#inputNum").val() + "&email=" + $("#email").val() + "&classid=" + layui.formSelects.value('select1', 'valStr'),
							dataType: 'json',
							contentType:'application/json',
							async: false,
							success: function(da) {
								if (da.success == 1) {
									layer.close(layerIndex);	//关闭加载动画
									layer.alert(da.msg, {
											icon: 6
										},
										function() {
											xadmin.father_reload();
										});


								} else {
									layer.close(layerIndex);	//关闭加载动画
									layer.alert(da.msg, {
										icon: 5
									});
									changeRanCode();
								}
							},
							error: function(da) {
								layer.close(layerIndex);	//关闭加载动画
									layer.alert("注册失败，激活邮件发送失败！", {
										icon: 5
									});
							}
							
						})
						return false;
	                });
	            });
	            
	            /*获取初始化下拉框课程选项*/
				function getSelectClass() {
					$.ajax({
							type: "POST", 
							url: "User/getSelectClass",
							data: '',
							async: false,
							dataType: 'json', 
							success: function(data) {
								var classse = data.data;
					           //遍历成功返回的json数据，取出对应内容进行展示
					           $.each(classse, function (index,item) {
		                              var class_name = classse[index].className;
		                              var class_id = classse[index].classId;
					               //构造动态option
					               $('#classId').append("<option value='"+class_id+"'>"+class_name+"</option>")
					           });
							}
						})
				}
         </script>
         <script type="text/javascript">
         	  //获取验证码
         	  changeRanCode();

			  function changeRanCode(){
				$("#img").attr("src","User/GetRanCode?ran=" + Math.random());
			  }
         		
		      var popup = function(){
		            if (document.getElementById('alert').style.display != 'none') {
		              document.getElementById('alert').style.display = 'none';
		              document.getElementById('background_fade').style.display = 'none';
		            }else{
		              document.getElementById('alert').style.display = 'block';
		              document.getElementById('background_fade').style.display = 'block';
		            } 
		            $("#img").attr("src","User/GetRanCode?ran=" + Math.random());
		        }
		        var EventUtil = {
		            addHandle: function(element, type, handler){
		                if(element.addEventListener){
		                    element.addEventListener(type, handler, false);
		                }else if (element.attachEvent) {
		                    element.attachEvent("on"+type, handler);
		                }else{
		                    element["on"+type] = handler;
		                }
		            }
		        }
		        
		        //显示验证码
		        function showValidate() {
		        	document.getElementById("validate").style.display="block";
		        }
		        
    </script>
    </body>
	
</html>