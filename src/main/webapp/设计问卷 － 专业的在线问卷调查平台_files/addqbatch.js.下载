function generateQs(){var a,b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb;if(!txtContent.value)return alert("请复制问卷文本到文本框里面！"),void 0;for(window.parent.batAddQTimes++,a=txtContent.value,a=replace_specialChar(a),lines=a.split("\n"),b=lines.length,d=!1,e="",f="",g="",lineIndex=0;b>lineIndex;lineIndex++)c=lines[lineIndex],h=lines[lineIndex+1],i=/^\s*([A-Za-z])[^A-Za-z0-9]/,j=!0,IsBlank(c)&&IsBlank(h)||(IsBlank(c)&&h&&(k="",l=h.match(i),l&&(k=l[1]),l&&g&&(l=g.match(i),l&&(e=l[1])),"A"!=k&&"a"!=k||""!=e?e&&k&&k.charCodeAt(0)==e.charCodeAt(0)+1&&(j=!1,e=k,d=!0):(j=!1,e=k,d=!0)),IsBlank(c)||(g=c),j&&(f+=c+"\n"));for(d&&(txtContent.value=a=f,lines=a.split("\n"),b=lines.length),m="",o="",p=!1,q=!0,r=!1,s=!1,qType="question",isDigitBig=!1,t=/^\s*([一二三四五六七八九十][\.。、\x20\t．:：]|[（(][一二三四五六七八九十][)）]|第[一二三四五六七八九十])/g,u=0,titleProcessed=!1,firstQuestion=null,lineIndex=0,curChar=0,lineIndex=0;b>lineIndex;lineIndex++)if(c=lines[lineIndex],t.exec(c)&&u++,u>5){isDigitBig=!0;break}for(choiceStartWithNumber=!1,prevChoiceD=0,isCompact=!1,x=!1,lineIndex=0;b>lineIndex;lineIndex++)if(c=lines[lineIndex],!IsBlank(c)){StartWithDigit(c)&&(isCompact=!0,x=!0);break}try{for(;;){if(lineIndex>=b)break;if(c=trim(lines[lineIndex]),y=!1,titleProcessed||(IsBlank(c)||(o=c,qType="question",p=!1,s=!1,o.contains(MatrixType)||o.contains(LikertMatrixType)||o.contains(RevLikertMatrixType)||o.contains("[矩阵单选题]")?(q=!0,qType="matrix"):o.contains(TableType)?(q=!0,r=!0,qType="matrix"):o.contains(SumType)?qType="sum":o.contains(SortType)?qType="sort":o.contains(LikertType)||o.contains(ReverseLikertType)?qType="likert":o.contains(CheckQType)||o.contains(CeShiQCheckType)?qType="check":o.contains(RadioQType)||o.contains(CeShiQType)?qType="radio":o.contains(PageType)?(qType="page",pageStartIndex=lineIndex+1):o.contains(GapFillType)||o.contains(GapFillTest)||o.contains(CeShiJianDaType)||o.contains(kaoshiBlankType)?qType="question":(o.contains(CutType)||isCompact&&IsCut(o))&&(qType="cut",cutStartIndex=lineIndex+1),titleProcessed=!0),lineIndex++),titleProcessed){if(z=lineIndex,A=0,B=!1,C=!0,D=!1,m="",E=o.contains(GapFillType)||o.contains(GapFillTest),!E)for(;b>z;z++)if(F=lines[z],isCompact){if(prevIsNewQ=!1,IsBlank(F)){choiceStartWithNumber=!1;break}if(isKaoShi&&StartWithDigit(F)){choiceStartWithNumber=!1;break}A++}else{if(IsBlank(F))break;A++}for(;z>lineIndex;lineIndex++)if(F=trim(lines[lineIndex]),"cut"==qType||"page"==qType)m+=lines[lineIndex],z-1>lineIndex&&(m+="<br/>"),cutEndIndex=lineIndex+1,pageEndIndex=lineIndex+1;else if(!IsBlank(F))if(B=!0,"matrix"==qType)if(q){for(G="103",r&&(G="303",itemValue=0),tempDataNode=AddMatrixTitle(o,qIndex,G),qIndex++,H=F.split(/(\x20|\t)+/gi),I=0;I<H.length;I++)isEmpty(trim(H[I]))||itemValue++,AddSelectItem(tempDataNode,H[I]);if(r)for(J=1;J<tempDataNode._select.length;J++)tempDataNode._select[J]._item_value=J;q=!1}else if(r){for(H=F.split(/(\x20|\t)+/gi),I=0;I<H.length;I++)AddColumn(tempDataNode,H[I]);r=!1}else F.startWith(LabelItem)?label=F.substr(4):AddMatrixLine(tempDataNode,F);else if("sum"==qType)s||(tempDataNode=AddSumTitle(o,qIndex),qIndex++,s=!0),s&&(F.startWith(LabelItem)?label=F.substr(4):AddMatrixLine(tempDataNode,F));else if(o.contains(kaoshiBlankType)&&"check"!=qType&&"radio"!=qType&&"sort"!=qType&&"likert"!=qType)qType="question",y||(tempDataNode=AddQuestion(o,qIndex),y=!0),K=/(答案[：:])\s*/,L=null,L=F.match(K),M=/(解析[：:])\s*/,N=null,N=F.match(M),L?processQuesAnswer(tempDataNode,!1,F):N&&processQuesAnswer(tempDataNode,!0,F),B=!1;else{if("sort"!=qType&&"likert"!=qType&&"check"!=qType&&"radio"!=qType&&(qType="radio",isCheck(o)&&(qType="check")),O=!1,!p){if(O=!1,!O){if(D=ContainsAB(F,lines,lineIndex,z),D&&!isKaoShi)for(P=F.toUpperCase(),curChar=65;90>curChar&&(Q=String.fromCharCode(curChar),R=String.fromCharCode(curChar+1),S=P.indexOf(Q),T=P.indexOf(R),S>-1&&T>-1);curChar++)numPerNow++;else if(1==A&&isCompact&&!isEnglish&&!isKaoShi)if(U=/□|○|①|②|③|④|⑤|⑥|⑦|⑧/gi,H=F.split(U),H.length>=3)numPerNow=H.length-1;else if(H=F.split(/(\d\d?\.|\d\d?、|\(\d\d?\)|（\d\d?）)/gi),H.length<4&&(H=F.split(/(\x20|\t)+/gi)),H.length<3){if(!(o.contains(RadioQType)||o.contains(CeShiQType)||o.contains(CeShiQCheckType))){qType="question",B=!1;break}numPerNow=6}else numPerNow=(H.length+1)/2;tempDataNode=AddSelectTitle(o,qIndex,qType)}itemValue=0,qIndex++,p=!0}if(p&&!O)if(F.startWith(LabelItem))label=F.substr(4);else{if(("radio"==qType||"likert"==qType)&&itemValue++,H=null,V=!1,isCompact)if(C&&(D=ContainsAB(F,lines,lineIndex,z),C=!1,curChar=65),D){if(P=F.toUpperCase(),W=null,W=isKaoShi?P.match(/[A-Z]{2,}/gi):P.match(/[A-Z][A-Z0-9\-]{1,}/gi))for(X=0;X<W.length;X++){for(Y=W[X].length,Z="",$=0;Y>$;$++)Z+="*";P=P.replace(W[X],Z)}for(_="";90>curChar;curChar++)if(Q=String.fromCharCode(curChar),R=String.fromCharCode(curChar+1),bb=String.fromCharCode(curChar-1),S=P.indexOf(Q),T=P.indexOf(R),cb=P.indexOf(bb),db=P.indexOf("其它"),-1==db&&(db=P.indexOf("其他")),-1==T&&(R=String.fromCharCode(curChar+2),T=P.indexOf(R),T>-1&&curChar++),S>-1&&T>-1)_=F.substring(S,T),AddSelectItem(tempDataNode,_);else if(S>-1)_=F.substring(S),AddSelectItem(tempDataNode,_);else{if(db>-1&&-1==cb){_=F.substring(db),AddSelectItem(tempDataNode,_);break}if(!(-1==S&&T>-1))break;_=F.substring(db),AddSelectItem(tempDataNode,_),curChar++}isKaoShi&&!_&&(eb=!1,F.indexOf("答案")>-1&&-1==F.indexOf("解析")&&(eb=!0),fb=F.match(/([A-Z]+)/),fb&&fb[1]?AddSelectItem(tempDataNode,F):(gb=trim(F).match(/^答?案?\s*解析[\:：\s]/),gb&&AddSelectItem(tempDataNode,F))),V=!0}else if(!isEnglish&&!isKaoShi&&(U=/(□|○|①|②|③|④|⑤|⑥|⑦|⑧)/gi,H=F.split(U),hb=!1,ib=1,H.length<4&&(H=F.split(/(\d\d?\.|\d\d?、|\(\d\d?\)|（\d\d?）)/gi),H.length<4&&(H=F.split(/(\x20|\t)+/gi),hb=!0,ib=0)),H.length>1))for(V=!0,I=ib;I<H.length;I++)hb?AddSelectItem(tempDataNode,H[I]):(AddSelectItem(tempDataNode,H[I]+H[I+1]),I++);V||AddSelectItem(tempDataNode,F)}}if(B){if(tempDataNode._endLine=lineIndex,o.contains(LikertType)||o.contains(ReverseLikertType)||o.contains(LikertMatrixType)||o.contains(RevLikertMatrixType))for(jb=o.contains(RevLikertMatrixType)||o.contains(ReverseLikertType),kb=1,jb&&(kb=tempDataNode._select.length-1),J=1;J<tempDataNode._select.length;J++)tempDataNode._select[J]._item_value=kb,jb?kb--:kb++;else if(o.contains(CeShiQType)||o.contains(CeShiQCheckType)||isKaoShi){if(tempDataNode._hasvalue=!0,tempDataNode._isCeShi=!0,tempDataNode._ceshiDesc="",tempDataNode._ceshiValue=5,lb=/\,\s*\[\s*(\d+)秒\]\s*$/,mb=tempDataNode._title.match(lb),mb&&mb[1]&&(tempDataNode._title=tempDataNode._title.replace(lb,"")),nb=/[\(（\[]?\s*(\d+)分[\)）\]]?\s*$/,mb=tempDataNode._title.match(nb),mb&&mb[1]&&(tempDataNode._ceshiValue=parseInt(mb[1])||5,tempDataNode._title=tempDataNode._title.replace(nb,"")),ob=/[\(（]\s*(答案[：:])?\s*([A-L、]+)\s*[\)）]/,pb=!1,L=tempDataNode._title.match(ob),qb=!1,rb=tempDataNode._select.length,L&&L[2]){for(sb=L[2].replace(/、/g,""),J=1;rb>J;J++)for(tb=trim(tempDataNode._select[J]._item_title),ub=0;ub<sb.length;ub++)if(tb.startWith(sb[ub])){tempDataNode._select[J]._item_radio=!0,pb=!0,qb=!0;break}pb||1!=sb.length||"B"!=sb[0]&&"A"!=sb[0]||3!=tempDataNode._select.length||(pb=!0,vb=1,qb=!0,"B"==sb[0]&&(vb=2),tempDataNode._select[vb]._item_radio=!0),sb.length>1&&(tempDataNode._type="check")}else{for(wb=0,J=1;J<tempDataNode._select.length;J++)tb=trim(tempDataNode._select[J]._item_title),(tb.contains("（正确答案）")||tb.contains("(正确答案)"))&&(tempDataNode._select[J]._item_radio=!0,wb++,tempDataNode._select[J]._item_title=tb.replace("（正确答案）","").replace("(正确答案)",""),pb=!0);wb>1&&"radio"==tempDataNode._type&&(tempDataNode._type="check")}if(rb>2&&(xb=/^答?案?\s*解析[\:：\s]/,yb=trim(tempDataNode._select[rb-1]._item_title),zb=tempDataNode._select[rb-2]._item_title,Ab=!1,tb.match(xb)&&(tempDataNode._ceshiDesc=yb.replace(xb,""),tempDataNode._select.pop(),Ab=!0),K=/([A-Z]+)/,L=null,eb=!1,Bb=yb,Ab&&(Bb=zb),Bb.indexOf("答案")>-1&&-1==Bb.indexOf("解析")&&(L=Bb.match(K)),L&&L[1]&&(tempDataNode._select.pop(),!pb))){for(sb=L[1],J=1;J<tempDataNode._select.length;J++)for(tb=trim(tempDataNode._select[J]._item_title),ub=0;ub<sb.length;ub++)if(tb.startWith(sb[ub])){tempDataNode._select[J]._item_radio=!0,pb=!0;break}pb||1!=sb.length||"B"!=sb[0]&&"A"!=sb[0]||3!=tempDataNode._select.length||(pb=!0,vb=1,"B"==sb[0]&&(vb=2),tempDataNode._select[vb]._item_radio=!0),sb.length>1&&(tempDataNode._type="check")}for(pb?qb&&(tempDataNode._title=tempDataNode._title.replace(ob,"（）")):tempDataNode._select[1]._item_radio=!0,Cb=0,Db=0,Eb=0,J=1;J<tempDataNode._select.length;J++)tb=trim(tempDataNode._select[J]._item_title),tb.match(/^[A-Z]/)?(0==Eb&&(Eb=J),Cb++):Db=J;if(Db>0&&1==Eb-Db&&Cb>=2){for(Fb="",J=1;Db>=J;J++)Fb+="<br/>"+tempDataNode._select[J]._item_title;tempDataNode._title=tempDataNode._title+Fb,tempDataNode._select.splice(1,Db)}}tempDataNode._select&&tempDataNode._numperrow>=tempDataNode._select.length&&(tempDataNode._numperrow=tempDataNode._select.length-1),createQ(tempDataNode),tempDataNode=null}else if("cut"==qType||"page"==qType)m=isEmpty(m)?o:o+"<br/>"+m,tempDataNode="cut"==qType?AddCut(m):AddPage(m),createQ(tempDataNode);else if("question"==qType&&o.contains(kaoshiBlankType)&&tempDataNode)tempDataNode._ceshiValue||(tempDataNode._ceshiValue=5),createQ(tempDataNode),qIndex++,tempDataNode=null;else if("question"==qType){if(1==A)for(;z>lineIndex;lineIndex++)F=lines[lineIndex],IsBlank(F)||(o+=F);tempDataNode=AddQuestion(o,qIndex),createQ(tempDataNode),qIndex++,tempDataNode=null}else("gapfill"==qType||"radio"==qType)&&(createQ(tempDataNode),qIndex++,tempDataNode=null);titleProcessed=!1}}txtContent.value="",x&&1==window.parent.batAddQTimes&&(Gb=window.parent.document.getElementById("chkUseSelfTopic"),Gb.checked||(Gb.checked=!0,Gb.onclick())),window.parent.PDF_close()}catch(Hb){return divMsg.innerHTML="<div style='height:10px;'></div>问卷格式不对，<a target='_blank' href='/help/help.aspx?helpid=138&h=1'>查看示例文本</a>",isKaoShi&&(divMsg.innerHTML="<div style='height:10px;'></div>问卷格式不对，<a target='_blank' href='/help/help.aspx?helpid=252&h=1'>查看示例文本</a>"),void 0}}function clearTxt(){txtContent.value=""}function createQ(a){hasInsert=window.parent.curinsert?!0:!1,window.parent.lastAddNewQTime=(new Date).getTime();var b=window.parent.createQ(a);hasInsert&&window.parent.insertQ(b)}function trim(a){return a&&a.replace?a.replace(/(^[\s\u3000]*)|([\s\u3000]*$)/g,""):a}function toInt(a){return parseInt(trim(a))}function isEmpty(a){return""==trim(a)}function isInt(a){var b=/^-?[0-9]+$/;return b.test(a)}function SBCCaseToNumberic(a){var c,b="";for(c=0;c<a.length;c++)b+=12288!=a.charCodeAt(c)?a.charCodeAt(c)>65280&&a.charCodeAt(c)<65375?String.fromCharCode(a.charCodeAt(c)-65248):String.fromCharCode(a.charCodeAt(c)):String.fromCharCode(a.charCodeAt(c)-12256);return b}function DBC2SBC(a){var c,d,e,b=a.value;if(b.length<=0)return!1;for(qstr1="ＡＢＣＤＥＦＧＨＩＪＫＭＮＯＰＱＲＳＴＵＶＷＸＹＺａｂｃｄｅｆｇｈｉｊｋｍｎｏｐｑｒｓｔｕｖｗｘｙｚ１２３４５６７８９０［］（）",bstr1="ABCDEFGHIJKMNOPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz1234567890[]()",d=!1,c=0;c<b.length;c++)e=b.charAt(c),-1!=qstr1.indexOf(e)&&(b=b.replace(e,bstr1.charAt(qstr1.indexOf(e))),d=!0);d&&(a.value=b)}function checkEnglish(){var d,e,a=txtContent.value.replace(/\n|\r/gi," "),b=a.match(/[a-z]+[\s\?\,\.]/gi),c=0;b&&(c=b.length+1),d=0,b=a.match(/[\u4e00-\u9fa5]/gi),b&&(d=b.length+1),e=document.getElementById("divEnglish"),c>d&&(e.style.display="",isEnglish=!0,cbEnglish.checked=!0)}function GetStartDigit(a){var b,c,d,e,f;return a=trim(a),b=/^\s*([a-zA-Z]|问题|第)?\s*\d+|\(\d\)+|[\uFF10-\uFF19]+|（[\uFF10-\uFF19]+）/g,c=-1,d=b.exec(a),d&&(e=d[0],e.length>1&&(e.charAt(0)>="a"&&e.charAt(0)<="z"||e.charAt(0)>="A"&&e.charAt(0)<="Z")&&(e=e.substr(1)),e=e.replace(/第\s*/,"").replace(/问题\s*/,""),f=SBCCaseToNumberic(e),c=isInt(f)?toInt(f):-1),isDigitBig&&(b=/^\s*([一二三四五六七八九十]{1,3})/g,d=b.exec(a))?ChineseNumberToArabicNumber(d[0]):c}function StartWithDigit(a){var c,d,e,f,g,h,i,b=GetStartDigit(a);if(-1==b)return IsSample(a);if(b>=3e3)return!1;if(c=/^\s*\d+\s*[-－—~～]{1,3}\s*\d+/g,c.test(a)||/^\s*\d+[次万%千小年以岁元人本个后级GXM分版]/.test(a))return!1;if(b==prevDigit+1&&!choiceStartWithNumber){if("matrix"==qType){if(b==prevMatrixDigit+1)return!1;if(!StartWithQType(a))return!1}return prevDigit=b,choiceStartWithNumber=!1,!0}if(-1==prevDigit&&(prevDigit=b),"matrix"==qType&&(prevMatrixDigit=b),c=/\d[\.、]|\(?\d\)|（?\d）/g,d=a.match(c),d&&d.length>=2){for(e=!0,f=0;f<d.length;f++)g=d[f],h=toInt(g),0!=prevChoiceD&&(i=h-prevChoiceD,(0==i||1!=h/i-prevChoiceD/i)&&(e=!1)),prevChoiceD=h;if(e)return!1;prevChoiceD=0}return"matrix"!=qType||StartWithQType(a)?(titleProcessed&&"cut"!=qType&&1==b&&(choiceStartWithNumber=!0),choiceStartWithNumber?!1:!0):!1}function ChineseNumberToArabicNumber(a){var c,d,e,f,g,b=/(^[一二三四五六七八九十]$)|(^十[一二三四五六七八九]$)|(^[二三四五六七八九]十?[一二三四五六七八九]{0,1}$)/;if(!b.exec(a))return-1;switch(c=-1,d="",e="一二三四五六七八九十",f=[1,2,3,4,5,6,7,8,9,10],g=a.length){case 1:c=f[e.indexOf(a)];break;case 2:"十"!=a[0]?(d=f[e.indexOf(a[0])]+"",d+="十"==a[1]?"0":f[e.indexOf(a[1])],c=toInt(d)):(d="1",d+=f[e.indexOf(a[1])],c=toInt(d));break;case 3:d=f[e.indexOf(a[0])]+"",d+=f[e.indexOf(a[2])]+"",c=toInt(d)}return c}function StartWithQType(a){return a.contains(MatrixType)||a.contains(LikertMatrixType)||a.contains(RevLikertMatrixType)||a.contains("[矩阵单选题]")||a.contains(SumType)||a.contains(RadioQType)||a.contains(CeShiQType)||a.contains(CeShiQCheckType)||a.contains(SortType)||a.contains(TableType)||a.contains(GapFillType)||a.contains(GapFillTest)||qTitle.contains(kaoshiBlankType)||a.contains(LikertType)||a.contains(ReverseLikertType)||a.contains(CutType)||a.contains(PageType)||IsCut(a)?!0:a.contains(AllQType)?!0:!1}function IsCut(a){var b,c;return a=trim(a),b=/^\s*(基本信息|个人信息)/g,b.exec(a)?!0:isDigitBig?!1:(b=/^\s*【?([一二三四五六七八九][\.。、\x20\t．:：]|[（(][一二三四五六七八九][)）]|第[一二三四五六七八九])/g,b.exec(a)?(c=a.match(/[一二三四五六七八九]/g).length,c>2?!1:!0):!1)}function IsSample(a){if(a=trim(a),a.endWith(":")||a.endWith("："))for(var b=0;b<SampleArray.length;b++)if(a.contains(SampleArray[b]))return!0;return!1}function IsBlank(a){if(void 0==a)return!1;var b=/^(\-|=|_)+$/g;return a=trim(a),b.exec(a)?!0:isEmpty(a)||"\n"==a?!0:!1}function IsNumber(a){return"0"==a||"1"==a||"2"==a||"3"==a||"4"==a||"5"==a||"6"==a||"7"==a||"8"==a||"9"==a?!0:!1}function isCheck(a){return isKaoShi?!1:a.contains("单选")?!1:(a.contains("多")||a.contains("复数")||a.contains("限")||a.contains("最少")||a.contains("至少"))&&a.contains("选")?!0:a.contains("哪些")?!0:!1}function AddQuestion(a,b){var c,d,e,f,g,h;if(a.contains(GapFillStr)||a.match(/[\{｛].*?[\}｝]/))return AddGapFill(a,b);if(c=new Object,c._type="question",c._topic=b+"",d=!1,a.contains(GapFillTest)||a.contains(CeShiJianDaType)||isKaoShi){if(c._isCeShi=!0,c._ceshiDesc="",e=/[\(（]?\s*([×错√对])\s*[\)）]?\s*$/,f=a.match(e),f&&f[1])return c._type="radio",c._title=a.replace(e,""),c._keyword="",c._relation="",c._hasvalue=!0,c._ceshiDesc="",c._ceshiValue=5,c._hasjump=!1,c._anytimejumpto="0",c._requir=!0,c._ins="",c._randomChoice=!1,c._verify="",c._numperrow=1,c._ispanduan=!0,c._select=new Array,c._select.push(new Object),g=f[1].contains("对")||f[1].contains("√"),h=new Object,h._item_title="对",h._item_radio=g,h._item_value="",h._item_jump="0",h._item_tb=!1,h._item_tbr=!1,h._item_img="",h._item_imgtext=!1,h._item_desc="",h._item_label="",c._select.push(h),h=new Object,h._item_title="错",h._item_radio=!g,h._item_value="",h._item_jump="0",h._item_tb=!1,h._item_tbr=!1,h._item_img="",h._item_imgtext=!1,h._item_desc="",h._item_label="",c._select.push(h),c;(a.contains(CeShiJianDaType)||a.contains("[简答题]"))&&(c._answer="简答题无答案",c._ceshiValue=5,c._height=3,d=!0)}return c._type="question",isKaoShi&&(c._answer=a.contains(kaoshiBlankType)?"请设置答案":"简答题无答案"),c._title=ProcessTitle(a.replace(e,"").replace(kaoshiBlankType,"")),c._keyword="",c._relation="",c._verify="",c._tag="",d||(c._height=1),c._maxword="",c._requir=!1,c._norepeat=!1,c._default="",c._ins="",c._hasjump=!1,c._anytimejumpto="0",c._needOnly=!1,c._hasList=!1,c._listId=-1,c._width="",c._underline=!1,c._minword="",c._startLine=lineIndex,c._endLine=lineIndex,c}function getGapFillCount(a){var f,b=0,c=0,d=a.length,e=a.match(/(\{.*?\})/g);if(e)return e.length;do if(c=a.indexOf(GapFillStr,c),-1!=c)for(b++,c+=GapFillStr.length,f=c;d>f&&"_"==a.charAt(f);f++)c++;while(-1!=c);return b}function replaceGapFill(a,b){var g,h,i,j,k,l,c=0,d=0,e=new StringBuilder,f=0;do if(d=c,c=a.indexOf(GapFillStr,c),g=GapFillStr,-1!=c){for(h=0,e.append(a.substr(d,c-d)),c+=GapFillStr.length,i=c;i<a.length&&"_"==a[i];i++)h++,g+="_",c++;j=GapWidth+h*(GapWidth/3),k=!1,b._rowVerify[f]&&"日期"==b._rowVerify[f]._verify&&(j=70,k=!0),l=GapFillReplace.replace("width:"+GapWidth+"px","width:"+j+"px"),l=b._useTextBox?l.replace("/>"," class='inputtext'/>"):l.replace("/>"," class='underline'/>"),e.append(l),f++}else d<a.length&&e.append(a.substr(d));while(-1!=c);return e.toString()}function AddGapFill(a,b,c){var f,g,h,i,j,d=getGapFillCount(a),e=new Object;if(e._type="gapfill",e._topic=b+"",e._verify="",(a.contains(GapFillTest)||isKaoShi)&&(e._isCeShi=!0),a=ProcessTitle(a.replace(kaoshiBlankType,"")),e._title=a,e._keyword="",e._relation="",e._tag="",e._requir=!0,e._gapcount=d,e._ins="",e._hasjump=!1,e._anytimejumpto="0",e._useTextBox=!1,e._rowVerify=new Array,isKaoShi)if(c){if(f=c.replace(/(答案|答[：:])\s*/,""),g=f.split(/[；;]/),d=getGapFillCount(a),h=g.length<d?g.length:d,h>0)for(i=0;h>i;i++)e._rowVerify[i]=new Object,e._rowVerify[i]._answer=trim(g[i]),e._rowVerify[i]._ceshiValue=1;a=a.replace(/([\{｛].*?[\}｝])/g,"______"),e._title=a}else if(j=a.match(/[\{｛].*?[\}｝]/g),j&&j.length>0){for(i=0;i<j.length;i++)e._rowVerify[i]=new Object,e._rowVerify[i]._answer=trim(j[i].replace("{","").replace("}","").replace("｛","").replace("｝","")),e._rowVerify[i]._ceshiValue=1;a=a.replace(/([\{｛].*?[\}｝])/g,"______"),e._title=a}return e._startLine=lineIndex,e._endLine=lineIndex,e}function AddSelectTitle(a,b,c){var e,f,d=new Object;return d._startLine=lineIndex,d._tag="","sort"==c?(d._type="check",d._tag="1",a=a.replace(SortType,"")):"likert"==c?(d._type="radio",d._tag="101",a=a.replace(LikertType,"").replace(ReverseLikertType,"")):(d._type=c,a=a.replace(CeShiQType,"").replace(CeShiQCheckType,"")),d._topic=b+"","check"==c&&(e=/限选(\d)项/,f=a.match(e),f&&f[1]>0&&(d._lowLimit=f[1],d._upLimit=f[1],a=a.replace(e,"")),e=/最多选(\d)项/,f=a.match(e),f&&f[1]>0&&(d._upLimit=f[1],d._lowLimit="",a=a.replace(e,"")),e=/[最至]少选(\d)项/,f=a.match(e),f&&f[1]>0&&(d._lowLimit=f[1],d._upLimit="",a=a.replace(e,""))),a=ProcessTitle(a),d._title=a,d._keyword="",d._relation="",d._hasvalue="likert"==c?!0:!1,d._hasjump=!1,d._anytimejumpto="0",d._requir=!0,d._ins="",d._randomChoice=!1,d._verify="",numPerNow>=6&&(numPerNow/=2),"您的性别："==a&&1==numPerNow&&(d._verify="性别",numPerNow=6),d._numperrow=numPerNow,numPerNow=1,d._select=new Array,d._select.push(new Object),d}function AddSelectItem(a,b){var c,d;b=trim(b).replace("□",""),IsBlank(b)||(c=!1,b.endWith(GapFillStr)||b.endWith(GapFillStr+")")||b.endWith(GapFillStr+"）")?(b=b.replace(/[_]/g,""),c=!0):(b.contains("请注明")||b.contains("请说明"))&&(b=b.replace(/[(（]?(请注明|请说明|请填写)[)）]?/g,""),c=!0),d=new Object,d._item_title=b,d._item_radio=!1,d._item_value="",d._item_jump="0",d._item_tb=c,d._item_tbr=!1,c&&(d._item_tbr=!0),d._item_img="",d._item_imgtext=!1,d._item_desc="",d._item_label=label||"",label="",a._select.push(d))}function AddColumn(a,b){isEmpty(trim(b))||(a._columntitle?a._columntitle+="\n"+b:a._columntitle=b)}function AddMatrixTitle(a,b,c){var d=new Object;return d._startLine=lineIndex,d._type="matrix",d._topic=b+"",d._keyword="",d._relation="",d._verify="",(a.contains(LikertMatrixType)||a.contains(RevLikertMatrixType))&&(c="101"),a=ProcessTitle(a),a="303"==c?a.replace(TableType,""):a.replace(MatrixType,"").replace(LikertMatrixType,"").replace(RevLikertMatrixType,"").replace("[矩阵单选题]",""),d._tag=c,d._title=a,d._hasvalue="303"==c||"101"==c?!0:!1,d._hasjump=!1,d._anytimejumpto="0",d._requir=!0,d._ins="",d._rowwidth="",d._rowwidth2="",d._rowtitle="",d._rowtitle2="",d._columntitle="",d._select=new Array,d._select.push(new Object),d}function AddMatrixLine(a,b){IsBlank(b)||(a._rowtitle||(a._rowtitle=""),a._rowtitle&&(a._rowtitle+="\n"),isEmpty(label)||(a._rowtitle+=DesignLabelItem+label+"\n",label=""),a._rowtitle+=b)}function AddSumTitle(a,b){var c=new Object;return c._startLine=lineIndex,c._verify="",c._type="sum",c._topic=b+"",c._keyword="",c._relation="",a=ProcessTitle(a),a=a.replace(SumType,""),c._title=a,c._tag="",c._hasjump=!1,c._anytimejumpto="0",c._requir=!0,c._ins="",c._rowwidth=100,c._total=100,c}function ContainsAB(a,b,c,d){var e,f,g,h,i,j,k;return isEnglish?!1:(e=a.toUpperCase(),f=e.indexOf("A"),g=!1,h=!1,f>-1&&(g=!0,f+1<e.length&&e.charAt(f+1)>="A"&&e.charAt(f+1)<="Z"&&(g=!1)),i=!1,j=g&&!e.contains("AB"),j&&(f=e.indexOf("B"),f>-1&&(h=!0,f+1<e.length&&e.charAt(f+1)>="A"&&e.charAt(f+1)<="Z"&&(h=!1)),!h&&d>c+1&&(k=b[c+1].toUpperCase(),f=k.indexOf("B"),f>-1&&(h=!0,f+1<k.length&&k.charAt(f+1)>="A"&&k.charAt(f+1)<="Z"&&(h=!1))),h&&(i=!0)),i)}function replace_specialChar(a){return a.replace(/(§)/g,"ξ").replace(/(¤)/g,"○").replace(/(〒)/g,"╤")}function regsplit(a,b){var f,c=a.split(b),d=a.match(b),e=[c[0]];if(!d)return e;for(f=0;f<d.length;++f)e[2*f+1]=d[f],e[2*f+2]=c[f+1];return e}function ProcessTitleItems(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(isEnglish)return!1;if(b=!1,c=null,d=a.toUpperCase(),e=a,f="radio",isCheck(a)&&(f="check"),g=d.indexOf("A"),h=!1,i=!1,g>-1&&(h=!0,g+1<d.length&&d.charAt(g+1)>"A"&&d.charAt(g+1)<"Z"&&(h=!1)),g=d.indexOf("B"),g>-1&&(i=!0,g+1<d.length&&d.charAt(g+1)>"A"&&d.charAt(g+1)<"Z"&&(i=!1)),j=h&&i&&!d.contains("AB"),j&&!isKaoShi)for(c=regsplit(a,/[A-Z][^A-Z]/gi),e=c[0],b=!0,numPerNow=(c.length-1)/2,tempDataNode=AddSelectTitle(e,qIndex,f),k=1;k<c.length;k+=2)l=c[k]+c[k+1],AddSelectItem(tempDataNode,l);else if(m=/□|○|①|②|③|④|⑤|⑥|⑦|⑧/gi,c=a.split(m),c.length>=3){for(numPerNow=c.length-1,n=e.search(m),e=e.substr(0,n),tempDataNode=AddSelectTitle(e,qIndex,f),k=1;k<c.length;k+=1)l=c[k],isEmpty(l)||AddSelectItem(tempDataNode,l);b=!0}return b}function ProcessTitle(a){var c,d,b=0;if(a=a.replace("[单选题]","").replace("[复选题]","").replace("[多选题]","").replace("[主观题]","").replace("[问答题]","").replace("[必答题]","").replace("(可多选)","").replace("[排序题]","").replace("(多选)","").replace("[矩阵题]","").replace("[矩阵单选题]","").replace("[段落说明]","").replace("[表格题]","").replace("[比重题]","").replace("[分页栏]","").replace(AllQType,"").replace("[测试填空题]","").replace(CeShiJianDaType,"").replace("[简答题]",""),!isCompact&&IsNumber(a.charAt(0))){if(!StartWithDigit(a))return a;for(b++,c=1;c<a.length;c++)if(IsNumber(a.charAt(c)))b++;else{if(d=a.charAt(c),"."!=d&&"。"!=d&&"、"!=d&&" "!=d&&"．"!=d)break;b++}return a.substr(b)}return a}function AddCut(a){var c,b=new Object;return b._type="cut",b._title=a.replace(CutType,""),b._tag="",b._startLine=cutStartIndex,c=a.split("\n").length,b._endLine=cutStartIndex+c,b}function processQuesAnswer(a,b,c){var d,e;b?(d=/(解析[：:])\s*/,e=null,e=c.replace(d,""),a._ceshiDesc=e):(d=/(答案[：:])\s*/,e=null,e=c.replace(d,""),a._answer=e)}var SampleArray,MatrixType="[矩阵题]",LikertMatrixType="[矩阵量表题]",RevLikertMatrixType="[矩阵反向量表题]",TableType="[表格题]",SumType="[比重题]",SortType="[排序题]",LikertType="[量表题]",ReverseLikertType="[反向量表题]",LabelItem="[标签]",DesignLabelItem="【标签】",CutType="[段落说明]",PageType="[分页栏]",AllQType="[题目]",CheckQType="[多选题]",RadioQType="[单选题]",GapFillType="[问答题]",GapFillTest="[测试填空题]",CeShiQType="[测试题]",CeShiQCheckType="[测试多选题]",CeShiJianDaType="[测试简答题]",kaoshiBlankType="[填空题]",label="",qType="",isCompact=!1,GenerateType=1,qIndex=1,itemValue=0,needExcute=!1,prevDigit=-1,prevMatrixDigit=-1,numPerNow=1,isNotClick=!1,total_page=0,tempDataNode=null,curPos=0,lineCharCount=2,lineIndex=0,lines=null,cutStartIndex=0,cutEndIndex=0,pageStartIndex=0,pageEndIndex=0,isEnglish=!1,prevChoiceD=0,choiceStartWithNumber=!1,GapFillStr="___",GapWidth=21,GapFillReplace="<input style='width:"+GapWidth+"px;' />",curChar=0,titleProcessed=!1,isDigitBig=!1,firstQuestion=null,hasInsert=!1;String.prototype.contains=function(a){return-1!=this.indexOf(a)},String.prototype.endWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substring(this.length-a.length)==a?!0:!1},String.prototype.startWith=function(a){return null==a||""==a||0==this.length||a.length>this.length?!1:this.substr(0,a.length)==a?!0:!1},cbEnglish.onclick=function(){isEnglish=cbEnglish.checked},txtContent.onpaste=function(){setTimeout(function(){DBC2SBC(txtContent),txtContent.value=txtContent.value.replace(/\</g,"&lt;").replace(/\>/g,"&gt;"),checkEnglish()},40)},SampleArray=["公司","工作","薪水","收入","部门","职业","职别","年龄","姓名","性别","婚","学校","年级","专业","院系","邮件","Email","手机","电话","地址","城市"];